$(function(){var e,t,s,i,o,n,a,l,r,c,d,p,f,h,m,v,u,x,g,b,w,k,C,E,y,A,O,z,F,M,I,T,q,P,S,Y=document.documentElement,B=$(".xl-photo li"),X="",D=isshowimglist=!0,R=iszoom=isrotate=isfullscreenmove=!1,L=[],U="",j="",G=[],H=[];$(".xl-backtotop").css("margin-left","720px");var J=function(){return Y.requestFullscreen||Y.webkitRequestFullscreen||Y.mozRequestFullScreen||Y.msRequestFullscreen},K=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},N=function(){return document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen};B.each(function(e){var t=$(this);b=t.find("h1"),w=t.find("a"),L[e]=[b.prev().find("img")[0].src,b.text(),b.next().text(),w.parent().prev()[0].src,w.text(),w.parent().next().text()],X+='<li><a><img src="'+L[e][0]+'" title="'+L[e][1]+'" /></a></li>'}),G=["remove","leftrotate","rightrotate","rerotate","zoomin","zoomout","original","fullscreen","like","comment","keep","download"],H=["当前图片位置已居中","向左旋转90°","向右旋转90°","当前已显示实际方向","放大","缩小","当前已显示实际大小","全屏浏览","点赞","评论","收藏","保存原图到电脑"];for(var Q=0;Q<G.length;Q++)Q<8?U+='<a class="xl-photospage-icon xl-ps-icon-'+G[Q]+'" title="'+H[Q]+'"></a>':j+='<li title="'+H[Q]+'"><a class="xl-photospage-tab-btn xl-photospage-'+G[Q]+'-btn"><i class="xl-photospage-icon xl-ps-icon-'+G[Q]+'"></i></a></li>';B.on("click",".xl-photo-img",function(){M=$(this).parent().index(),I=0,C=L.length,xlbtndisabled="xl-photospage-imgdisabled",html.css("overflow","hidden").not("html").append('<div id="xl-mask" class="xl-mask"></div><div id="xl-photospage" class="xl-photospage"><div class="xl-photospage-main"></div></div>'),t=$("#xl-mask"),s=$("#xl-photospage"),i=s.find("div.xl-photospage-main");var b=function(e){return e.length<=18?e+"<em> "+(M+1)+"/"+C+"</em>":e.substring(0,18)+"<em>… "+(M+1)+"/"+C+"</em>"};i.prepend('<div class="xl-photospage-imgarea"><div class="xl-photospage-state"></div><a class="xl-photospage-icon xl-ps-icon-fullscreenclose" title="退出全屏"></a><div class="xl-photospage-img"><img /></div><div class="xl-photospage-imgsee"><a class="xl-photospage-icon xl-ps-icon-prevphoto"><!--[if IE 6]>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<![endif]--></a><a class="xl-photospage-icon xl-ps-icon-nextphoto"><!--[if IE 6]>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<![endif]--></a><div class="xl-photospage-imgbar"><a class="xl-photospage-showimglist" title="隐藏图片列表">隐藏图片列表</a><span class="xl-photospage-imgtit" title="'+L[M][1]+'">'+b(L[M][1])+'</span><div class="xl-photospage-tool">'+U+'</div></div></div><div class="xl-photospage-imglist"><a class="xl-photospage-icon xl-ps-icon-listprve"></a><div class="xl-photospage-imglist-list clearfix" ><ul>'+X+'</ul></div><a class="xl-photospage-icon xl-ps-icon-listnext"></a></div><div class="xl-photospage-fullscreen-ious"><div></div></div></div>'),o=i.find("div.xl-photospage-imgarea"),n=o.find("div.xl-photospage-state"),a=o.find("div.xl-photospage-img img"),r=o.find("a.xl-ps-icon-prevphoto"),c=r.next(),u=o.find("div.xl-photospage-imglist-list ul"),x=o.find("a.xl-ps-icon-listprve"),g=u.find("li"),o.after('<div class="xl-photospage-intro"><div class="xl-photospage-content"><h1>'+L[M][1]+'</h1><div class="xl-photospage-handle-tab"><ul class="clearfix">'+j+'</ul></div><div class="xl-photospage-userinfo clearfix"><div class="xl-photospage-user-avatar" onselectstart="return false;"><img src="'+L[M][3]+'" alt="上传者头像" /></div><div class="xl-photospage-section"><div class="xl-photospage-user-info"><a href="#" title="'+L[M][4]+'">'+L[M][4]+'</a></div><div class="xl-photospage-timestamp">'+L[M][5]+"</div></div></div><p>"+L[M][2]+'</p></div></div><div class="xl-photospage-vanish"><a class="xl-photospage-icon xl-ps-icon-close" title="关闭"></a></div>'),d=i.find("div.xl-photospage-content"),p=o.find("span.xl-photospage-imgtit"),l=i.find("a.xl-ps-icon-close"),f=o.find("a.xl-ps-icon-"+G[1]),h=f.next().next(),m=o.find("a.xl-ps-icon-"+G[6]),v=d.find("div.xl-photospage-timestamp"),k=o.find("a.xl-photospage-showimglist"),$.browser.msie&&"10.0"!==$.browser.version&&$.browser.version<="9.0"&&(f.prev().hide().nextAll().hide(),m.show().prevUntil(h).show(),"9.0"===$.browser.version&&f.prev().show(),$.browser.version<="7.0"&&(k.hide(),u.parent().parent().hide())),J()||m.next().hide();var w=function(){if(O=win.width()-500,z=win.height()-50,E=a.width(),A=a.height(),O+300<=1250?p.next().hide():p.next().show(),i.css({width:O+300,height:z}).parent().fadeTo(300,1),o.removeAttr("style").width(O),!R&&o.hasClass("xl-imgarea-fullscreen")&&(O+=500,z+50),a.css({width:E,height:A,top:(z-A)/2-27,left:(O-E)/2,opacity:"1"}),$.browser.msie&&"6.0"===$.browser.version&&(d.parent().css("margin-left",O+15),s.css("top",dom.scrollTop()+25),p.next().hide().parent().width(O)),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(s.addClass("xl-photospage-mobile"),o.width(win.width()).height(win.height()).next().hide().end().parent().width(win.width()),a.css({top:(z-A)/2,left:(O+500-E)/2}),c.parent().next().hide()),P=Math.round((O-60)/61),q=Math.round((C-P)/7+1),q<1&&(q=1),D){for(D=!1,T=1,S=0;M+1>=P+S&&T!=q&&M+1>P;)T++,S+=7;T!==q?Y(T):B(),g.removeAttr("class").eq(M).addClass("xl-photospage-current").parent().width(61*C)}se(q,T)},Y=function(e){u.stop().animate({marginLeft:-7*(e-1)*61})},B=function(){1!=q&&(u.stop().animate({marginLeft:-(61*(C-P)+30)}),T=q,S=7*(q-1))},H=function(e){n.text(e).css("left",O/2-n.width()/2-20).stop().show().delay(1500).hide(0),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&n.css("left",O+25-n.width()/2-20)},Q=function(e){M+=e,M===C&&(M=0),M===-1&&(M=C-1),W(),Z()},V=function(e){I+=e,a.css({transition:"transform .2s linear",transform:"rotate("+I+"deg)"}),I/90%4!==0?isrotate=!0:isrotate=!1,ee()},W=function(){isrotate=!1,I=0,ee(),a.css({transform:"",transition:""})},Z=function(){iszoom=!1,a.css({width:y,height:F,top:a.position().top-(F-A)/2,left:a.position().left-(y-E)/2}),ee()},_=function(){R=!1,a.attr("src",L[M][0]).css({width:"",height:""}).parent().removeAttr("style"),d.find("h1").text(L[M][1]).end().find("p").text(L[M][2]),p.html(b(L[M][1])).attr("title",L[M][1]),v.text(L[M][5]).prev().find("a").text(L[M][4]).attr("title",L[M][4]).end().parent().prev().find("img").attr("src",L[M][3]),g.removeAttr("class").eq(M).addClass("xl-photospage-current"),w(),ee(),y=E,F=A},ee=function(){var e=function(e,t,s){"add"===t?$(e).addClass(xlbtndisabled):$(e).removeClass(xlbtndisabled),$(e).attr("title",s)};R?e(f.prev(),"del","图片居中"):e(f.prev(),"add","当前图片位置已居中"),iszoom?e(m,"del","实际大小"):e(m,"add","当前已显示实际大小"),isrotate?e(h,"del","还原方向"):e(h,"add","当前已显示实际方向")},te=function(e){iszoom=!0,E=a.width(),A=a.height(),a.parent().css("background","#000");var t=e*E,s=e*A;if(e>1){if(t>10*y)return!H("已放到最大")}else if(t<y/10)return!H("已缩到最小");a.css({width:t,height:s}).offset({top:a.offset().top-(s-A)/2,left:a.offset().left-(t-E)/2}),H(Math.round(t/y*100)+"%"),ee()},se=function(e,t){e===t?x.next().next().addClass(xlbtndisabled):x.next().next().removeClass(xlbtndisabled),e>=t&&1!=t?x.removeClass(xlbtndisabled):x.addClass(xlbtndisabled)},ie=function(e){if("next"===e){if(T===q)return T=q,u.is(":animated")||H("已是最后一页啦"),!1;T+1===q?B():(S+=7,T++,Y(T))}else{if(1===T)return u.is(":animated")||H("已是第一页啦"),S=0,!1;T<=0?T=1:(S-=7,T--,Y(T))}se(q,T)},oe=function(){P+S===M+1&&M+1>=P&&T!=q&&ie("next"),(8+(S-7)===M+1&&1!==T&&T!=q||C-P+1===M+1&&T===q)&&ie("prev")};_(),a.on("mousedown",function(e){if(0===e.button){R=isfullscreenmove=!0,$(this).parent().css("background","#000"),ee();var t,s,i=!0;I/90%4===0?(t=e.originalEvent.pageX-a.position().left,s=e.originalEvent.pageY-a.position().top):(t=e.originalEvent.pageX-a.offset().left,s=e.originalEvent.pageY-a.offset().top),dom.on("mousemove",function(e){if(i){var o=a.position().left,n=a.position().top;n<-A+30||o<-E+30||o>O-30||n>z-120?dom.off("mouseup"):dom.on("mouseup",function(){i=isfullscreenmove=!1}),I/90%4===0?a.css({top:e.originalEvent.pageY-s,left:e.originalEvent.pageX-t}):a.offset({top:e.originalEvent.pageY-s,left:e.originalEvent.pageX-t})}}).on("mouseup",function(){i=isfullscreenmove=!1})}return!1}).parent().on("dblclick",function(){J()&&(dom.off("mousemove mouseup"),m.next().click())}).on("mousewheel DOMMouseScroll",function(e){if($.browser.msie&&"6.0"===$.browser.version)return!1;if(!isfullscreenmove){var t=e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta>0?1:-1)||e.originalEvent.detail&&(e.originalEvent.detail>0?-1:1);te(t>0?1.1:.9)}}),s.on("click",function(e){var i=e.target;switch(i){case l[0]:D=!0,html.removeAttr("style").not("html").css("background-color","#f4f4f4"),$.browser.msie&&($.browser.version<"9.0"||"10.0"===$.browser.version)?(t.detach(),s.detach()):t.fadeTo(300,0,function(){$(this).detach()}).next().fadeTo(250,0,function(){$(this).detach()}),dom.off("keyup");break;case r[0]:0===M?B():oe(),Q(-1),_();break;case c[0]:M+1===C&&(S=0,T=1,Y(T)),T===q?B():oe(),Q(1),_();break;case f.prev()[0]:if(f.prev().hasClass(xlbtndisabled)){H("图片已居中");break}R=!1,w(),ee();break;case f[0]:V(-90);break;case f.next()[0]:V(90);break;case h[0]:if(h.hasClass(xlbtndisabled)){H("已显示实际方向");break}W();break;case h.next()[0]:te(1.1);break;case m.prev()[0]:te(.9);break;case m[0]:if(m.hasClass(xlbtndisabled)){H("已显示实际大小");break}Z();break;case m.next()[0]:J()?(K()?N().call(document):J().call(o[0]),f.prev().hasClass(xlbtndisabled)||f.prev().click(),win.resize()):H("浏览器不支持全屏");break;case n.next()[0]:m.next().click();break;case x[0]:ie("prev");break;case x.next().next()[0]:ie("next");break;case k[0]:k.parent().hasClass("hide")?(k.text("隐藏图片列表").attr("title","隐藏图片列表"),c.next().removeAttr("style").removeClass("hide"),u.parent().parent().removeAttr("style"),isshowimglist=!0):(k.text("显示图片列表").attr("title","显示图片列表"),c.next().css("bottom","0").addClass("hide"),u.parent().parent().css("height","0"),isshowimglist=!1)}return!1}),t.on("dblclick",function(){l.click()}),u.on("click","a",function(){return M=$(this).parent().index(),oe(),_(),W(),!Z()}),dom.on("keyup",function(e){var t=e.keyCode||e.which||e.charCode;switch(t){case 27:if(o.hasClass("xl-imgarea-fullscreen"))break;l.click();break;case 37:0!==M&&r.click();break;case 38:te(1.1);break;case 39:c.click();break;case 40:te(.9);break;case 76:V(-90);break;case 82:V(90)}return!1}),win.on("resize",function(){e&&e&&clearTimeout(e),e=setTimeout(function(){var e=$(".xl-photospage-fullscreen-ious");if(K()){isshowimglist||(e.css("bottom","0"),k.parent().css("bottom","30px"));var t,s=function(){if(K())if("61px"===e.prev().css("height")||k.parent().is(":hover"))r.is(":animated")||r.fadeOut().next().fadeOut();else{if(r.is(":hover"))return c.fadeOut(),!1;if(c.is(":hover"))return r.fadeOut(),!1;k.parent().is(":animated")||k.parent().fadeOut(),r.is(":animated")||r.fadeOut().next().fadeOut()}};o.on("mouseenter",function(){s()}).on("mousemove",function(i){e.on("mouseover",function(){isfullscreenmove||$(this).hide().prev().removeAttr("style").prev().find("div").css("bottom","61px")}),win.height()-130>i.originalEvent.pageY&&(e.is(":animated")||e.fadeIn().css("bottom","0").prev().css("height","0").prev().find("div").css("bottom","30px")),k.parent().is(":animated")||k.parent().fadeIn(),r.is(":animated")||r.fadeIn().next().fadeIn(),t&&clearTimeout(t),t=setTimeout(s,1750)}),k.hide(),m.next().addClass("xl-ps-icon-exitfullscreen"),o.addClass("xl-imgarea-fullscreen").next().hide()}else isshowimglist||k.click(),e.removeAttr("style").off("mouseover").prev().removeAttr("style").prev().find("div").removeAttr("style").find("a").removeAttr("style"),m.next().removeClass("xl-ps-icon-exitfullscreen"),o.off("mouseenter").off("mousemove").removeClass("xl-imgarea-fullscreen").next().show();w()},200)})})});