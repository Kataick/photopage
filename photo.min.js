/**
 * photo.js v2.1.6
 * @author KkakaMann
 * @mailto KkakaMann24@gmail.com  KkakaMann@163.com
 */
$(function(){var e,t,s,i,n,o,a,l,r,c,d,p,h,f,x,u,m,g,v,b,w,k,E,C,z,F,A,y,M,T,q,O,P,S,L=document.documentElement,B=$(".xl-photo li"),I="",X=!0,Y=iszoom=isrotate=!1,D=[],R="",j="",U=[],G=[];$(".xl-backtotop").css("margin-left","720px");var H=function(){return L.requestFullscreen||L.webkitRequestFullscreen||L.mozRequestFullScreen||L.msRequestFullscreen},J=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},K=function(){return document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen};B.each(function(e){b=$(this).find("h1"),w=$(this).find("a"),D[e]=[b.prev().find("img")[0].src,b.text(),b.next().text(),w.parent().prev()[0].src,w.text(),w.parent().next().text()],I+='<li><a><img src="'+D[e][0]+'" /></a></li>'}),U=["remove","leftrotate","rightrotate","rerotate","zoomin","zoomout","original","fullscreen","like","comment","keep","download"],G=["当前图片位置已居中","向左旋转90°","向右旋转90°","当前已显示实际方向","放大","缩小","当前已显示实际大小","全屏浏览","点赞","评论","收藏","保存原图到电脑"];for(var N=0;N<U.length;N++)N<8?R+='<a class="xl-photospage-icon xl-ps-icon-'+U[N]+'" title="'+G[N]+'"></a>':j+='<li title="'+G[N]+'"><a class="xl-photospage-tab-btn xl-photospage-'+U[N]+'-btn"><i class="xl-photospage-icon xl-ps-icon-'+U[N]+'"></i></a></li>';B.find(".xl-photo-img").on("click",function(){M=$(this).parent().index(),T=0,k=D.length,xlbtndisabled="xl-photospage-imgdisabled",html.css("overflow","hidden").not("html").append('<div id="xl-mask" class="xl-mask"></div><div id="xl-photospage" class="xl-photospage"><div class="xl-photospage-main"></div></div>'),t=$("#xl-mask"),s=$("#xl-photospage"),i=s.find("div.xl-photospage-main");var b=function(e){return e.length<=18?e+"<em> "+(M+1)+"/"+k+"</em>":e.substring(0,18)+"<em>… "+(M+1)+"/"+k+"</em>"};i.prepend('<div class="xl-photospage-imgarea"><div class="xl-photospage-state"></div><a class="xl-photospage-icon xl-ps-icon-fullscreenclose" title="退出全屏"></a><div class="xl-photospage-img"><img src="'+D[M][0]+'" /></div><div class="xl-photospage-imgsee"><a class="xl-photospage-icon xl-ps-icon-prevphoto"><!--[if IE 6]>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<![endif]--></a><a class="xl-photospage-icon xl-ps-icon-nextphoto"><!--[if IE 6]>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<![endif]--></a><div class="xl-photospage-imgbar"><span class="xl-photospage-imgtit" title="'+D[M][1]+'">'+b(D[M][1])+'</span><div class="xl-photospage-tool">'+R+'</div></div></div><div class="xl-photospage-imgchoose"><a class="xl-photospage-icon xl-ps-icon-chooseprve"></a><div class="xl-photospage-imgchoose-list clearfix" ><ul>'+I+'</ul></div><a class="xl-photospage-icon xl-ps-icon-choosenext"></a></div></div>'),n=i.find("div.xl-photospage-imgarea"),o=n.find("div.xl-photospage-state"),a=n.find("div.xl-photospage-img img"),r=n.find("a.xl-ps-icon-prevphoto"),c=r.next(),m=n.find("div.xl-photospage-imgchoose-list ul"),g=n.find("a.xl-ps-icon-chooseprve"),v=m.find("li"),n.after('<div class="xl-photospage-intro"><div class="xl-photospage-content"><h1>'+D[M][1]+'</h1><div class="xl-photospage-handle-tab"><ul class="clearfix">'+j+'</ul></div><div class="xl-photospage-userinfo clearfix"><div class="xl-photospage-user-avatar" onselectstart="return false;"><img src="'+D[M][3]+'" alt="上传者头像" /></div><div class="xl-photospage-section"><div class="xl-photospage-user-info"><a href="#" title="'+D[M][4]+'">'+D[M][4]+'</a></div><div class="xl-photospage-timestamp">'+D[M][5]+"</div></div></div><p>"+D[M][2]+'</p></div></div><div class="xl-photospage-vanish"><a class="xl-photospage-icon xl-ps-icon-close" title="关闭"></a></div>'),d=i.find("div.xl-photospage-content"),p=n.find("span.xl-photospage-imgtit"),l=i.find("a.xl-ps-icon-close"),h=n.find("a.xl-ps-icon-"+U[1]),f=h.next().next(),x=n.find("a.xl-ps-icon-"+U[6]),u=d.find("div.xl-photospage-timestamp"),$.browser.msie&&"10.0"!==$.browser.version&&$.browser.version<="9.0"&&(h.prev().hide().nextAll().hide(),x.show().prevUntil(f).show(),"9.0"===$.browser.version&&h.prev().show(),$.browser.version<="7.0"&&m.parent().parent().hide()),($.browser.msie&&$.browser.version<="9.0"||$.browser.msie&&"10.0"===$.browser.version)&&x.next().hide();var w=function(){if(F=win.width()-500,A=win.height()-50,E=a.width(),z=a.height(),F+300<=1250?p.next().hide():p.next().show(),i.css({width:F+300,height:A}).parent().fadeTo(300,1),n.removeAttr("style").width(F),!Y&&n.hasClass("xl-imgarea-fullscreen")&&(F+=500,A+50),a.css({width:E,height:z,top:(A-z)/2-27,left:(F-E)/2,opacity:"1"}),$.browser.msie&&"6.0"===$.browser.version&&(d.parent().css("margin-left",F+15),s.css("top",dom.scrollTop()+25),p.next().hide().parent().width(F)),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(s.addClass("xl-photospage-mobile"),n.width(win.width()).height(win.height()).next().hide().end().parent().width(win.width()),a.css({top:(A-z)/2,left:(F+500-E)/2}),c.parent().next().hide()),P=Math.round((F-60)/61),O=Math.round((k-P)/7+1),X){for(q=1,S=0;M+1>=P+S&&q!=O&&M+1>P;)q++,S+=7;q!==O?m.stop().animate({marginLeft:-7*(q-1)*61}):L(),ee(O,q),v.removeAttr("class").eq(M).addClass("xl-photospage-current").parent().width(61*k),X=!1}},L=function(){m.stop().animate({marginLeft:-(61*(k-P)+30)}),q=O,S=7*(O-1),ee(O,q)},B=function(e){o.text(e).css("left",F/2-o.width()/2-20).fadeTo(100,1,function(){setTimeout(function(){o.fadeOut(1e3)},1e3)}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&o.css("left",F+25-o.width()/2-20)},G=function(e){M+=e,M===k&&(M=0),M===-1&&(M=k-1),Q(),V()},N=function(e){T+=e,a.css({transition:"transform .2s linear",transform:"rotate("+T+"deg)"}),T/90%4!==0?isrotate=!0:isrotate=!1,Z()},Q=function(){isrotate=!1,T=0,Z(),a.css({transform:"",transition:""})},V=function(){iszoom=!1,a.css({width:C,height:y,top:a.position().top-(y-z)/2,left:a.position().left-(C-E)/2}),Z()},W=function(){Y=!1,a.attr("src",D[M][0]).css({width:"",height:""}).parent().removeAttr("style"),d.find("h1").text(D[M][1]).end().find("p").text(D[M][2]),p.html(b(D[M][1])).attr("title",D[M][1]),u.text(D[M][5]).prev().find("a").text(D[M][4]).attr("title",D[M][4]).end().parent().prev().find("img").attr("src",D[M][3]),v.removeAttr("class").eq(M).addClass("xl-photospage-current"),w(),Z(),C=E,y=z},Z=function(){var e=function(e,t,s){"add"===t?$(e).addClass(xlbtndisabled):$(e).removeClass(xlbtndisabled),$(e).attr("title",s)};Y?e(h.prev(),"del","图片居中"):e(h.prev(),"add","当前图片位置已居中"),iszoom?e(x,"del","实际大小"):e(x,"add","当前已显示实际大小"),isrotate?e(f,"del","还原方向"):e(f,"add","当前已显示实际方向")},_=function(e){iszoom=!0,E=a.width(),z=a.height(),a.parent().css("background","#000");var t=e*E,s=e*z;if(e>1){if(t>10*C)return!B("已放到最大")}else if(t<C/10)return!B("已缩到最小");a.css({width:t,height:s}),a.offset({top:a.offset().top-(s-z)/2,left:a.offset().left-(t-E)/2}),B(Math.round(t/C*100)+"%"),Z(),Y||w()},ee=function(e,t){e===t?g.next().next().addClass(xlbtndisabled):g.next().next().removeClass(xlbtndisabled),e>=t&&1!=t?g.removeClass(xlbtndisabled):g.addClass(xlbtndisabled)},te=function(e){if("next"===e){if(q===O)return q=O,m.is(":animated")||B("已是最后一页啦"),!1;q+1===O?L():(S+=7,q++,m.stop().animate({marginLeft:-7*(q-1)*61}))}else{if(1===q)return m.is(":animated")||B("已是第一页啦"),S=0,!1;q<=0?q=1:(S-=7,q--,m.stop().animate({marginLeft:-7*(q-1)*61}))}ee(O,q)},se=function(){P+S===M+1&&M+1>=P&&q!=O&&te("next"),(8+(S-7)===M+1&&1!==q&&q!=O||k-P+1===M+1&&q===O)&&te("prev")},ie=function(){S=0,q=1,m.stop().animate({marginLeft:-7*(q-1)*61}),ee(O,q)};W(),a.on("mousedown",function(e){if(0===e.button){Y=!0,$(this).parent().css("background","#000"),Z();var t,s,i=!0;T/90%4===0?(t=e.originalEvent.pageX-a.position().left,s=e.originalEvent.pageY-a.position().top):(t=e.originalEvent.pageX-a.offset().left,s=e.originalEvent.pageY-a.offset().top),dom.bind("mousemove",function(e){if(i){var n=a.position().left,o=a.position().top;o<-z+30||n<-E+30||n>F-30||o>A-120?dom.unbind("mouseup"):dom.bind("mouseup",function(){i=!1}),T/90%4===0?a.css({top:e.originalEvent.pageY-s,left:e.originalEvent.pageX-t}):a.offset({top:e.originalEvent.pageY-s,left:e.originalEvent.pageX-t})}}).bind("mouseup",function(){i=!1})}return!1}),s.on("click",function(e){var i=e.target;switch(i){case l[0]:html.removeAttr("style").not("html").css("background-color","#f4f4f4"),$.browser.msie&&$.browser.version<"9.0"&&"10.0"!==$.browser.version?(t.detach(),s.detach()):(t.fadeTo(300,0).next().fadeTo(250,0),setTimeout(function(){s.detach(),t.detach()},400),X=!0),dom.off("keyup");break;case r[0]:0===M?L():se(),G(-1),W();break;case c[0]:M+1===k&&ie(),q===O?L():se(),G(1),W();break;case h.prev()[0]:if(h.prev().hasClass(xlbtndisabled)){B("图片已居中");break}Y=!1,a.css({top:(A-z)/2-27,left:(F-E)/2}),Z();break;case h[0]:N(-90);break;case h.next()[0]:N(90);break;case f[0]:if(f.hasClass(xlbtndisabled)){B("已显示实际方向");break}Q();break;case f.next()[0]:_(1.1);break;case x.prev()[0]:_(.9);break;case x[0]:if(x.hasClass(xlbtndisabled)){B("已显示实际大小");break}V();break;case x.next()[0]:H()?(J()?K().call(document):H().call(n[0]),h.prev().hasClass(xlbtndisabled)||h.prev().click(),win.resize()):B("浏览器不支持全屏");break;case o.next()[0]:x.next().click();break;case g[0]:te("prev");break;case g.next().next()[0]:te("next");break;default:return!1}return!1}).find("a").attr({hidefocus:"true",href:"javascript:;"}),t.dblclick(function(){l.click()}),a.parent().dblclick(function(){x.next().click()}).on("mousewheel DOMMouseScroll",function(e){if($.browser.msie&&"6.0"===$.browser.version)return!1;var t=e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta>0?1:-1)||e.originalEvent.detail&&(e.originalEvent.detail>0?-1:1);_(t>0?1.1:.9)}),m.find("a").on("click",function(){return M=$(this).parent().index(),se(),W(),Q(),!V()}),dom.keyup(function(e){var t=e.keyCode||e.which||e.charCode;switch(t){case 27:if(n.hasClass("xl-imgarea-fullscreen"))break;l.click();break;case 37:0!==M&&r.click();break;case 38:_(1.1);break;case 39:M+1===k&&ie(),c.click();break;case 40:_(.9);break;case 76:N(-90);break;case 82:N(90);break;default:return!1}return!1}),win.on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){J()?(x.next().addClass("xl-photospage-imgexitfullscreen"),n.addClass("xl-imgarea-fullscreen").next().hide()):(x.next().removeClass("xl-photospage-imgexitfullscreen"),n.removeClass("xl-imgarea-fullscreen").next().show()),w()},200)})})});